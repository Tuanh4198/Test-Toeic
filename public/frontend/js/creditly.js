var Creditly=function(){function o(e,t){var r=document.querySelector(t).value.trim();return r+=String.fromCharCode(e.which),a(r)}function s(e){e.className=e.className.replace(/\bhas-error\b/,"")}function u(e,t,r){return e.preventDefault(),!!function(e){return/^\d+$/.test(String.fromCharCode(e.which))}(e)}function d(e){return e.match("^(34|37)")}function l(e,t,r){var n=e.currentTarget;return function(e,t,r){return o(e,r).length>t}(e,t,r)?(e.preventDefault(),!1):n.selectionStart===n.value.length&&(!function(e){return!(!e.metaKey&&!e.ctrlKey)||32!==e.which&&(0===e.which||e.which<33)}(e)&&u(e))}var v,m,p,f,c,g,h,a=function(e){return e.replace(/[^\d]/g,"")},i={createCvvInput:function(a,i){document.querySelector(a).addEventListener("keypress",function(e){var t=document.querySelector(a);s(t);var r=o(e,i),n=o(e,a),u=function(e){return e?4:3}(d(r));l(e,u,a)&&(t.value=n)})}},y=(v=[4,10,15],m=[4,8,12,16],p=function(e,t){for(var r=[],n=0,u=0;u<t.length;u++){if(!(e.length>t[u])){u<t.length?r.push(e.slice(n,t[u])):r.push(e.slice(n));break}r.push(e.slice(n,t[u])),n=t[u]}return 0<r.length?r.join(" "):e},{createNumberInput:function(c){document.querySelector(c).addEventListener("keypress",function(e){var t=document.querySelector(c);s(t);var r=o(e,c),n=d(r),u=function(e){return e?15:16}(n);if(l(e,u,c)){var a;a=p(r,n?v:m),t.value=a;var i=document.createEvent("HTMLEvents");i.initEvent("changed_input",!0,!0),t.dispatchEvent(i)}})}}),_=(f=/(\d\d)\s*\/\s*(\d\d)/,c=function(e){return 15==e.length},g=function(e){if(0===e.length)return!1;if(/[^0-9-\s]+/.test(e))return!1;for(var t=0,r=0,n=!1,u=e.length-1;0<=u;u--){var a=e.charAt(u);r=parseInt(a,10);n&&9<(r*=2)&&(r-=9),t+=r,n=!n}return t%10==0},h={creditCard:function(e,t){var r=document.querySelector(t.creditCardNumberSelector).value.trim().replace(/\D/g,""),n=[],u=!0,a=[];if(g(r)||(n.push(t.message.number),a.push(t.creditCardNumberSelector),u=!1),t.cvvSelector){var i=document.querySelector(t.cvvSelector).value.trim().replace(/\D/g,"");!function(e,t){return!!(e&&4==t.length||!e&&3==t.length)}(c(r),i)&&(n.push(t.message.security_code),a.push(t.cvvSelector),u=!1)}return result={is_valid:u,output_value:[r,i],selectors:a,messages:n},result},creditCardExpiration:function(e,t){var r=document.querySelector(e).value.trim(),n=f.exec(r),u=!1,a=["",""];if(n&&3===n.length){var i=parseInt(n[1],10),c=parseInt("20"+n[2],10);0<=i&&i<=12&&(u=!0,a=[i,c])}return{is_valid:u,messages:[t.message],output_value:a}}},{validate:function(e){var t=function(){var n=[],u=[];return{addError:function(e,t){t.hasOwnProperty("selectors")?u=u.concat(t.selectors):u.push(e),n=n.concat(t.messages)},triggerErrorMessage:function(){for(var e={selectors:u,messages:n},t=0;t<u.length;t++)document.querySelector(u[t]).className=document.querySelector(u[t]).className+" has-error";if(window.jQuery)window.jQuery("body").trigger("creditly_client_validation_error",e);else{var r=document.createEvent("MessageEvent");r.initMessageEvent("creditly_client_validation_error",!0,!0,e,"","","",null),document.body.dispatchEvent(r)}}}}(),r=function(){var a={};return{addOutput:function(e,t){for(var r=e.split("."),n=a,u=0;u<r.length;u++)n.hasOwnProperty(r[u])||(n[r[u]]={}),u===r.length-1?n[r[u]]=t:n=n[r[u]]},getOutput:function(){return a}}}(),n=!1;for(var u in e)S(u,e,t,r)&&(n=!0);return n?(t.triggerErrorMessage(),!1):r.getOutput()}});function S(e,t,r,n){if(t.hasOwnProperty(e)){var u=t[e],a=u.type,i=(u.name,h[a](e,u.data));if(!i.is_valid)return r.addError(e,i),!0;if(u.output_name instanceof Array)for(var c=0;c<u.output_name.length;c++)n.addOutput(u.output_name[c],i.output_value[c]);else n.addOutput(u.output_name,i.output_value)}}var E={createExpirationInput:function(u){document.querySelector(u).addEventListener("keypress",function(e){var t=document.querySelector(u);if(s(t),l(e,4,u)){var r=o(e,u);if(2<=r.length){var n=r.slice(0,2)+" / "+r.slice(2);t.value=n}else t.value=r}})}},b={changeCardType:function(n,u){function e(e){var t=document.querySelector(n).value,r=function(e){return/^(34|37)/.test(e)?"American Express":/^4/.test(e)?"Visa":/^5[0-5]/.test(e)?"MasterCard":/^(6011|622|64[4-9]|65)/.test(e)?"Discover":""}(a(t));document.querySelector(u).innerHTML=r}var t=document.querySelector(n);t.addEventListener("changed_input",e),t.addEventListener("keypress",e),t.addEventListener("keydown",e),t.addEventListener("keyup",e)}},C=function(e,t,r,n){var u=n||{};u.security_code_message=u.security_code_message||"Your security code is invalid",u.number_message=u.number_message||"Your credit card number is invalid",u.expiration_message=u.expiration_message||"Your credit card expiration is invalid";var a={};return a[t]={type:"creditCard",data:{cvvSelector:r,creditCardNumberSelector:t,message:{security_code:u.security_code_message,number:u.number_message}},output_name:["number","security_code"]},a[e]={type:"creditCardExpiration",data:{message:u.expiration_message},output_name:["expiration_month","expiration_year"]},a};return{initialize:function(e,t,r,n,u){var a=C(e,t,r,u);return E.createExpirationInput(e),y.createNumberInput(t),r&&i.createCvvInput(r,t),n&&b.changeCardType(t,n),{validate:function(){return _.validate(a)}}}}}();